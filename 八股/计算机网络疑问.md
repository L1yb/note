

[面试题：每发送一个http请求就要建立一个tcp连接吗（非持久连接/持久连接）_发一次数据包就要进行一次tcp连接吗-CSDN博客](https://blog.csdn.net/qq_44918090/article/details/120757316#:~:text=非持久连接： HTTP%2F1.0 中 的首部字段 Connection 默认值为 close，即每次请求都会重新建立和断开 TCP,持久连接： HTTP%2F1.1 中 的首部字段 Connection 默认值为 keep-alive ，连接可以复用，只要发送端、接收端都没有提出断开连接，则保持tcp连接状态。)

**每发送一个http请求就要建立一个tcp连接吗**

**非持久连接和持久连接**

- 非持久连接：在HTTP/1.0中首部字段close，**每次请求都会重现建立和断开TCP连接**

- 持久连接：http/1.1中Connection默认值已经修改为keep-alive，**连接可以复用，只要双端都没有提出断开连接，则保持tcp连接状态**

持久连接优点：减少tcp连接的重复建立和断开的开销，减轻了服务器的负担，实际上也使http请求和相应更早结束，



1. 握手和挥手的时机

   并不是每次传输数据都要重新握手，http1.1之后建立持续连接以后可以只需传输了

2. tcp握手的请求是谁发出来的，用户的数据中不应该有tcp握手的请求吧 ？

   tcp握手是**操作系统**（或者说**tcp/ip协议栈**）自动发出的，不涉及应用层

3. 在建立连接持续传输的过程中，如何知道现在还是不是连接的状态，或者数据有没有送达
   - 状态检测：全双工，TCP keep-alive机制
   - 确认送达：接收方发送ACK，失败重传

4. 从物理层面来说，最终都会成为mac包一个个传输，那是不是在到达服务端的时候也是一个个的到达，那服务端如何会产生并发的接收呢？

   - **从数据包传输的角度**：并发确实也是一个个数据包通过物理层的mac帧发送到目标端
   - **从操作系统的角度**：系统通**过网络栈和socket管理连接**，socket有发送缓冲区和接收缓冲区，系统通过**多线程或事件驱动模型来处理请求**，甚至一个线程中可以处理成千上万个请求

   总结：并发并不是物理层面上进行的，而是操作系统的处理方式，、